quarkus:
  application:
    name: quarkus-message-service
  http:
    port: 8089
    host: 0.0.0.0  # Escuchar en todas las interfaces

  apicurio-registry:
    devservices:
      enabled: false

  # Deshabilitar Dev Services - usar servicios externos
  devservices:
    enabled: false

  smallrye-health:
    ui:
      enabled: true

  # PostgreSQL
  datasource:
    db-kind: postgresql
    username: postgres
    password: 12345
    reactive:
      url: postgresql://192.168.1.90:5432/erp_tlm_2021

  # Swagger/OpenAPI - Activado en producci√≥n (puedes desactivar si lo prefieres)
  swagger-ui:
    always-include: true
    path: /swagger-ui

  # Redis Cache Configuration
  redis:
    hosts: redis://192.168.1.90:6379
    timeout: 10s
    max-pool-size: 20
    max-pool-waiting: 24
    devservices:
      enabled: false
  cache:
    enabled: false
    redis:
      expire-after-write: 2m
      prefix: "msg-svc"

  # Logging
  log:
    level: INFO
    category:
      org.walrex:
        level: DEBUG
      io.quarkus:
        level: INFO
    console:
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"

# Consul
consul:
  host: 192.168.1.90
  port: 8500
  service:
    host: ${quarkus.application.name}
  health:
    check:
      host: host.docker.internal

# Kafka Configuration
kafka:
  bootstrap:
    servers: 192.168.1.90:9092

# MicroProfile Messaging (Kafka) - Confluent Schema Registry
mp:
  messaging:
    connector:
      smallrye-kafka:
        "schema.registry.url": http://192.168.1.90:8081

    incoming:
      notification-events:
        connector: smallrye-kafka
        topic: notification-events
        value:
          deserializer: io.confluent.kafka.serializers.KafkaAvroDeserializer
        schema:
          registry:
            url: http://192.168.1.90:8081
        specific:
          avro:
            reader: true
        group:
          id: message-service-group
        auto:
          offset:
            reset: earliest
        enable:
          auto:
            commit: true

      # Canal para mensajes de inbox (procesamiento batch)
      inbox-messages:
        connector: smallrye-kafka
        topic: inbox-messages
        batch: true
        max:
          poll:
            records: 500
        value:
          deserializer: io.confluent.kafka.serializers.KafkaAvroDeserializer
        schema:
          registry:
            url: http://192.168.1.90:8081
        specific:
          avro:
            reader: true
        group:
          id: message-service-group
        auto:
          offset:
            reset: earliest
        enable:
          auto:
            commit: false

    outgoing:
      inbox-messages-out:
        connector: smallrye-kafka
        topic: inbox-messages
        value:
          serializer: io.confluent.kafka.serializers.KafkaAvroSerializer
        schema:
          registry:
            url: http://192.168.1.90:8081
        auto:
          register:
            schemas: true
      # Dead Letter Queue para notificaciones fallidas
      notification-events-dlq:
        connector: smallrye-kafka
        topic: notification-events-dlq
        value:
          serializer: io.confluent.kafka.serializers.KafkaAvroSerializer
        schema:
          registry:
            url: http://192.168.1.90:8081
        auto:
          register:
            schemas: true